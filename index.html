<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í˜ë‚´ìš” ì˜¤ëŠ˜</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffd1e8">

<link href="https://fonts.googleapis.com/css2?family=Poor+Story&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Poor Story','ë§‘ì€ ê³ ë”•',sans-serif;
  background:repeating-linear-gradient(
    45deg,#ffe4ec,#ffe4ec 20px,#ffd1e8 20px,#ffd1e8 40px
  );
  min-height:100vh;
  padding:10px;
  text-align:center;
}

.box-section{
  background:#fff;
  border:3px solid #ffb6d9;
  border-radius:22px;
  max-width:440px;
  margin:10px auto;
  padding:16px;
}

.oval-btn{
  background:#e3f2fd;
  border:2px solid #90caf9;
  border-radius:40px;
  padding:12px 30px;
  font-size:16px;
  font-weight:bold;
  margin:6px;
  cursor:pointer;
}

.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  justify-content:center;
  align-items:center;
}
.modal-box{
  background:#fff;
  border-radius:20px;
  padding:16px;
  width:92%;
  max-width:420px;
  text-align:left;
}
.close-x{
  cursor:pointer;
  font-size:18px;
}

.one-line-input{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:2px solid #ffb6d9;
  font-family:'Poor Story';
  margin-bottom:10px;
}

.date-header{
  font-weight:bold;
  cursor:pointer;
  margin-top:10px;
  background:#ffe4ec;
  padding:6px 10px;
  border-radius:10px;
}

.entry{
  border-bottom:1px dashed #ccc;
  padding:6px 0;
}
.entry small{font-weight:bold;}

.edit-btn,.del-btn{
  font-size:12px;
  margin-left:6px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="box-section">
  <button class="oval-btn" onclick="openOneLine()">ë‚˜ì˜ í•˜ë£¨ í•œë¬¸ì¥ âœï¸</button>
  <button class="oval-btn" onclick="backupData()">â˜ï¸ ë°±ì—…</button>
  <input type="file" id="restoreFile" hidden onchange="restoreData(event)">
  <button class="oval-btn" onclick="document.getElementById('restoreFile').click()">â˜ï¸ ë³µì›</button>
</div>

<!-- í•œë¬¸ì¥ ëª¨ë‹¬ -->
<div class="modal" id="oneLineModal">
  <div class="modal-box">
    <div class="close-x" onclick="closeOneLine()">âœ•</div>
    <p style="text-align:center;font-size:18px;">ì˜¤ëŠ˜ ë‚˜ì˜ í•˜ë£¨ë¥¼ í•œë¬¸ì¥ìœ¼ë¡œ</p>
    <input id="oneLineText" class="one-line-input" placeholder="í•œ ë¬¸ì¥ ì…ë ¥">
    <button class="oval-btn" onclick="saveOneLine()">ì €ì¥</button>
    <div id="oneLineList"></div>
  </div>
</div>

<script>
let editIndex=null;

/* ---------- í•œë¬¸ì¥ ---------- */
function openOneLine(){
  oneLineText.value="";
  editIndex=null;
  renderOneLine();
  oneLineModal.style.display="flex";
}
function closeOneLine(){oneLineModal.style.display="none";}

function saveOneLine(){
  const text=oneLineText.value.trim();
  if(!text) return;

  const list=JSON.parse(localStorage.getItem("oneLineMsgs")||"[]");
  const now=new Date();
  const dateKey=now.toISOString().slice(0,10);

  if(editIndex!==null){
    list[editIndex].text=text;
    editIndex=null;
  }else{
    list.unshift({text,date:now.toLocaleString("ko-KR"),key:dateKey});
  }

  localStorage.setItem("oneLineMsgs",JSON.stringify(list));
  oneLineText.value="";
  renderOneLine();
}

function renderOneLine(){
  const list=JSON.parse(localStorage.getItem("oneLineMsgs")||"[]");
  const grouped={};

  list.forEach((m,i)=>{
    if(!grouped[m.key]) grouped[m.key]=[];
    grouped[m.key].push({...m,index:i});
  });

  oneLineList.innerHTML=Object.keys(grouped).map(date=>`
    <div class="date-header" onclick="toggleDate('${date}')">
      ğŸ“… ${date}
    </div>
    <div id="group-${date}" style="display:none;">
      ${grouped[date].map(m=>`
        <div class="entry">
          <small>${m.date}</small><br>
          ${m.text}
          <span class="edit-btn" onclick="editLine(${m.index})">âœï¸</span>
          <span class="del-btn" onclick="deleteLine(${m.index})">ğŸ—‘</span>
        </div>
      `).join("")}
    </div>
  `).join("");
}

function toggleDate(date){
  const el=document.getElementById("group-"+date);
  el.style.display=el.style.display==="none"?"block":"none";
}

function editLine(i){
  const list=JSON.parse(localStorage.getItem("oneLineMsgs"));
  oneLineText.value=list[i].text;
  editIndex=i;
}

function deleteLine(i){
  const list=JSON.parse(localStorage.getItem("oneLineMsgs"));
  list.splice(i,1);
  localStorage.setItem("oneLineMsgs",JSON.stringify(list));
  renderOneLine();
}

/* ---------- ë°±ì—… / ë³µì› ---------- */
function backupData(){
  const data={
    oneLineMsgs:JSON.parse(localStorage.getItem("oneLineMsgs")||"[]"),
    savedMsgs:JSON.parse(localStorage.getItem("savedMsgs")||"[]")
  };
  const blob=new Blob([JSON.stringify(data,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="í˜ë‚´ìš”ì˜¤ëŠ˜_backup.json";
  a.click();
}

function restoreData(e){
  const file=e.target.files[0];
  const reader=new FileReader();
  reader.onload=()=>{
    const data=JSON.parse(reader.result);
    if(data.oneLineMsgs) localStorage.setItem("oneLineMsgs",JSON.stringify(data.oneLineMsgs));
    if(data.savedMsgs) localStorage.setItem("savedMsgs",JSON.stringify(data.savedMsgs));
    alert("ë³µì› ì™„ë£Œ!");
    renderOneLine();
  };
  reader.readAsText(file);
}

/* ---------- PWA ---------- */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
